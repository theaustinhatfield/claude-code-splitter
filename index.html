<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code Splitter</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --claude-orange: #D97757;
            --claude-cream: #F0EFEA;
            /* Pasty white tan */
            --claude-text: #191919;
            --claude-subtext: #6B6B6B;
            --border-color: #DCDAD5;
            --terminal-bg: #262626;
            --terminal-header: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--claude-cream);
            color: var(--claude-text);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            text-align: center;
        }

        /* Hero Section */
        h1 {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 18px;
            color: var(--claude-subtext);
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.5;
        }

        /* Configurator Card */
        .configurator {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            margin-bottom: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 16px;
            font-weight: 500;
        }

        input[type="number"] {
            width: 80px;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 18px;
            text-align: center;
            font-family: 'Inter', sans-serif;
            color: var(--claude-text);
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--claude-orange);
            box-shadow: 0 0 0 3px rgba(218, 119, 86, 0.1);
        }

        .command-box {
            width: 100%;
            background: var(--terminal-bg);
            border-radius: 8px;
            padding: 16px;
            position: relative;
            text-align: left;
        }

        .command-text {
            font-family: 'JetBrains Mono', monospace;
            color: #E5E5E5;
            font-size: 13px;
            line-height: 1.6;
            word-break: break-all;
            padding-right: 80px;
            /* Space for button */
            user-select: all;
            /* Make it easy to select */
            -webkit-user-select: all;
        }

        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--claude-orange);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s;
        }

        .copy-btn:hover {
            background-color: #C66345;
        }

        .copy-btn:active {
            transform: scale(0.98);
        }

        /* Terminal Preview */
        .preview-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--claude-subtext);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .terminal-window {
            background: var(--terminal-bg);
            border-radius: 12px;
            box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            border: 1px solid #333;
        }

        .terminal-bar {
            background: var(--terminal-header);
            padding: 10px 16px;
            display: flex;
            gap: 8px;
            border-bottom: 1px solid #333;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .red {
            background: #FF5F56;
        }

        .yellow {
            background: #FFBD2E;
        }

        .green {
            background: #27C93F;
        }

        .grid-container {
            max-height: 600px;
            overflow-y: auto;
            padding: 12px;
            /* Custom Scrollbar */
            scrollbar-width: thin;
            scrollbar-color: #444 var(--terminal-bg);
        }

        .grid-container::-webkit-scrollbar {
            width: 8px;
        }

        .grid-container::-webkit-scrollbar-track {
            background: var(--terminal-bg);
        }

        .grid-container::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .pane {
            background: #1e1e1e;
            border: 1px solid #333;
            height: 250px;
            /* Increased height */
            min-height: 200px;
            /* Minimum size */
            padding: 12px;
            padding-top: 36px;
            /* Space for header */
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: #ccc;
            text-align: left;
            position: relative;
            overflow-y: auto;
            /* Independent scrolling */
            scrollbar-width: thin;
            scrollbar-color: #444 var(--terminal-bg);
        }

        .pane::-webkit-scrollbar {
            width: 6px;
        }

        .pane::-webkit-scrollbar-track {
            background: transparent;
        }

        .pane::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 3px;
        }

        .pane-status {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: #252525;
            padding: 4px 8px;
            font-size: 10px;
            color: #888;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            z-index: 10;
            /* Keep header on top */
        }

        .prompt {
            color: #27C93F;
        }

        .cmd {
            color: white;
        }

        .output {
            color: #888;
            margin-top: 8px;
            display: block;
        }

        .cursor {
            display: inline-block;
            width: 6px;
            height: 12px;
            background: #888;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }

        /* ASCII Logo */
        .ascii-logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 8px;
            line-height: 8px;
            color: var(--claude-orange);
            margin-bottom: 24px;
            opacity: 0.8;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="ascii-logo">
            <pre>
  ____  _                  _   _     _                               
 / ___|| |_ __ _ _ __     | |_| |__ (_)___    _ __ ___ _ __   ___  
 \___ \| __/ _` | '__|    | __| '_ \| / __|  | '__/ _ \ '_ \ / _ \ 
  ___) | || (_| | |       | |_| | | | \__ \  | | |  __/ |_) | (_) |
 |____/ \__\__,_|_|        \__|_| |_|_|___/  |_|  \___| .__/ \___/ 
                                                      |_|          
</pre>
        </div>

        <h1>Claude Code Splitter</h1>
        <p class="subtitle">
            Run multiple Claude Code agents in parallel.<br>
            Configure your grid and copy the one-line command below.
        </p>

        <div class="configurator">
            <div class="input-group">
                <label>Number of Agents:</label>
                <input type="number" id="agentCount" value="6" min="1" max="30">
            </div>

            <!-- Step 1: Install -->
            <div style="margin-bottom: 20px;">
                <div
                    style="font-size: 12px; font-weight: 600; color: var(--claude-subtext); text-transform: uppercase; margin-bottom: 8px;">
                    Step 1: Install Claude Code</div>
                <div class="command-box">
                    <div class="command-text" id="installCmd">curl -fsSL https://claude.ai/install.sh | bash</div>
                    <button class="copy-btn" onclick="copyCmd('installCmd')">Copy</button>
                </div>
            </div>

            <!-- Step 2: Connect -->
            <div style="margin-bottom: 20px;">
                <div
                    style="font-size: 12px; font-weight: 600; color: var(--claude-subtext); text-transform: uppercase; margin-bottom: 8px;">
                    Step 2: Connect Account</div>
                <div class="command-box">
                    <div class="command-text" id="connectCmd">claude</div>
                    <button class="copy-btn" onclick="copyCmd('connectCmd')">Copy</button>
                </div>
            </div>

            <!-- Step 3: Launch -->
            <div style="margin-bottom: 24px;">
                <div
                    style="font-size: 12px; font-weight: 600; color: var(--claude-subtext); text-transform: uppercase; margin-bottom: 8px;">
                    Step 3: Launch Grid (Run every time)</div>
                <div class="command-box">
                    <div class="command-text" id="cmdText"></div>
                    <button class="copy-btn" onclick="copyCmd('cmdText')">Copy Command</button>
                </div>
            </div>

            <div id="nameInputs"
                style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; width: 100%; max-width: 800px;">
                <!-- Dynamic name inputs will appear here -->
            </div>
        </div>

        <div class="preview-label">Terminal Preview</div>

        <div class="terminal-window">
            <div class="terminal-bar">
                <div class="dot red"></div>
                <div class="dot yellow"></div>
                <div class="dot green"></div>
            </div>
            <div class="grid-container">
                <div class="grid" id="grid"></div>
            </div>
        </div>
    </div>

    <script>
        const grid = document.getElementById('grid');
        const input = document.getElementById('agentCount');
        const nameInputsContainer = document.getElementById('nameInputs');
        const cmdText = document.getElementById('cmdText');

        const tasks = [
            "Analyzing authentication flow...",
            "Running test suite (142/300)...",
            "Refactoring database schema...",
            "Updating API documentation...",
            "Checking for security vulnerabilities...",
            "Optimizing frontend bundle...",
            "Reviewing pull request #42...",
            "Generating migration scripts...",
            "Debugging websocket connection...",
            "Compiling TypeScript assets..."
        ];

        // Store custom data
        let agentData = {};

        function getAgentData(index) {
            return agentData[index] || {
                name: `Agent-${index}`,
                prompt: ""
            };
        }

        function renderInputs(count) {
            nameInputsContainer.innerHTML = '';

            nameInputsContainer.style.display = 'grid';
            nameInputsContainer.style.gridTemplateColumns = 'repeat(auto-fill, minmax(280px, 1fr))';
            nameInputsContainer.style.gap = '16px';

            for (let i = 1; i <= count; i++) {
                const data = getAgentData(i);
                const card = document.createElement('div');
                card.style.cssText = `
                background: white;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 16px;
                display: flex;
                flex-direction: column;
                gap: 12px;
                box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            `;

                // Header
                const header = document.createElement('div');
                header.style.cssText = "display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;";
                const title = document.createElement('span');
                title.textContent = `Agent ${i}`;
                title.style.fontWeight = "600";
                title.style.fontSize = "14px";
                header.appendChild(title);
                card.appendChild(header);

                // Name Input
                const nameGroup = document.createElement('div');
                const nameLabel = document.createElement('label');
                nameLabel.textContent = "Name";
                nameLabel.style.fontSize = '11px';
                nameLabel.style.textTransform = 'uppercase';
                nameLabel.style.letterSpacing = '0.5px';
                nameLabel.style.color = 'var(--claude-subtext)';
                nameLabel.style.marginBottom = '4px';
                nameLabel.style.display = 'block';

                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.value = data.name;
                nameInput.placeholder = `Agent-${i}`;
                nameInput.style.cssText = `
                padding: 8px;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                font-size: 14px;
                width: 100%;
                font-family: 'Inter', sans-serif;
                background: var(--claude-cream);
            `;
                nameInput.addEventListener('input', (e) => {
                    if (!agentData[i]) agentData[i] = getAgentData(i);
                    agentData[i].name = e.target.value || `Agent-${i}`;
                    update(parseInt(document.getElementById('agentCount').value), false);
                });
                nameGroup.appendChild(nameLabel);
                nameGroup.appendChild(nameInput);

                // Prompt Input
                const promptGroup = document.createElement('div');
                const promptLabel = document.createElement('label');
                promptLabel.textContent = "System Prompt";
                promptLabel.style.fontSize = '11px';
                promptLabel.style.textTransform = 'uppercase';
                promptLabel.style.letterSpacing = '0.5px';
                promptLabel.style.color = 'var(--claude-subtext)';
                promptLabel.style.marginBottom = '4px';
                promptLabel.style.display = 'block';

                const promptInput = document.createElement('textarea');
                promptInput.value = data.prompt;
                promptInput.placeholder = "Describe the agent's role...";
                promptInput.rows = 3;
                promptInput.style.cssText = `
                padding: 8px;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                font-size: 14px;
                width: 100%;
                font-family: 'Inter', sans-serif;
                resize: vertical;
                background: var(--claude-cream);
            `;
                promptInput.addEventListener('input', (e) => {
                    if (!agentData[i]) agentData[i] = getAgentData(i);
                    agentData[i].prompt = e.target.value;
                    update(parseInt(document.getElementById('agentCount').value), false);
                });
                promptGroup.appendChild(promptLabel);
                promptGroup.appendChild(promptInput);

                card.appendChild(nameGroup);
                card.appendChild(promptGroup);
                nameInputsContainer.appendChild(card);
            }
        }

        function update(count, shouldRenderInputs = true) {
            if (shouldRenderInputs) {
                renderInputs(count);
            }

            // 1. Update Grid
            grid.innerHTML = '';
            for (let i = 1; i <= count; i++) {
                const pane = document.createElement('div');
                pane.className = 'pane';
                const data = getAgentData(i);
                const taskDisplay = data.prompt ? data.prompt : tasks[(i - 1) % tasks.length];

                // Add some dummy history to demonstrate scrolling
                const history = `
<span style="color: #666"># Initializing environment...</span>
<span style="color: #666"># Loading configuration...</span>
<span style="color: #666"># Connecting to API...</span>
<br>
            `.trim();

                pane.innerHTML = `
                <div class="pane-status">
                    <span>${data.name}</span>
                    <span>bash</span>
                </div>
                <div style="margin-top: 0px;">
                    ${history}
                    <br>
                    <span class="prompt">âžœ</span> <span class="cmd">claude</span>
                    <span class="output">
                        <span style="color: #D97757">Claude Code</span><br>
                        ${taskDisplay}<span class="cursor"></span>
                    </span>
                    <br><br><br><br><br>
                    <span style="color: #444"># (Scroll to see more history)</span>
                </div>
            `;
                grid.appendChild(pane);
            }

            // 2. Generate One-Liner Command
            let shellCmds = [];

            // 1. Dependency Checks (Robustness)
            const depCheck = `
if ! command -v tmux &> /dev/null; then
  if command -v brew &> /dev/null; then brew install tmux;
  elif command -v apt-get &> /dev/null; then sudo apt-get update && sudo apt-get install -y tmux;
  else echo "Error: tmux not found."; exit 1; fi
fi;
if ! command -v claude &> /dev/null; then
  echo "Claude Code not found. Installing..."
  curl -fsSL https://claude.ai/install.sh | bash
fi
`.replace(/\n/g, ' ').trim(); // Minify into one line

            shellCmds.push(depCheck);

            // 2. Kill existing
            shellCmds.push(`tmux kill-session -t agents 2>/dev/null`);

            // 3. Start new session (detached)
            shellCmds.push(`tmux new-session -d -s agents`);

            // 4. Global options
            shellCmds.push(`tmux set -g mouse on`);
            shellCmds.push(`tmux set -g pane-border-status top`);
            shellCmds.push(`tmux set -g pane-border-format " #T "`);

            // Helper to escape for the HOST shell (single quotes)
            const escapeHost = (str) => {
                return str.replace(/'/g, "'\\''");
            };

            // Helper to generate command for a pane
            const getPaneCmd = (data) => {
                if (!data.prompt) return 'claude';

                // Escape for the TARGET shell (inside double quotes)
                const safePrompt = data.prompt
                    .replace(/\\/g, '\\\\')
                    .replace(/"/g, '\\"')
                    .replace(/\$/g, '\\$')
                    .replace(/`/g, '\\`');

                return `claude -p "${safePrompt}"`;
            };

            // 5. Setup Pane 1
            const data1 = getAgentData(1);
            shellCmds.push(`tmux select-pane -t 0 -T "${data1.name}"`);
            shellCmds.push(`tmux send-keys -t 0 '${escapeHost(getPaneCmd(data1))}' C-m`);

            if (count > 1) {
                const cols = Math.min(count, 3);

                // Create columns
                for (let c = 1; c < cols; c++) {
                    const data = getAgentData(c + 1);
                    shellCmds.push(`tmux split-window -h`);
                    shellCmds.push(`tmux select-pane -T "${data.name}"`);
                    shellCmds.push(`tmux send-keys '${escapeHost(getPaneCmd(data))}' C-m`);
                }

                // Create rows
                for (let i = cols + 1; i <= count; i++) {
                    const data = getAgentData(i);
                    shellCmds.push(`tmux split-window -v`);
                    shellCmds.push(`tmux select-pane -T "${data.name}"`);
                    shellCmds.push(`tmux send-keys '${escapeHost(getPaneCmd(data))}' C-m`);
                }

                shellCmds.push(`tmux select-layout tiled`);
            }

            shellCmds.push(`tmux attach -t agents`);

            const finalCmd = shellCmds.join('; ');
            cmdText.textContent = finalCmd;
        }

        function copyCmd(elementId) {
            const text = document.getElementById(elementId).textContent;

            // Try modern API first
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showCopyFeedback(elementId);
                }).catch(err => {
                    console.error('Clipboard API failed:', err);
                    fallbackCopy(text, elementId);
                });
            } else {
                fallbackCopy(text, elementId);
            }
        }

        function fallbackCopy(text, elementId) {
            const textArea = document.createElement("textarea");
            textArea.value = text;

            // Ensure it's not visible but part of DOM
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            textArea.style.top = "0";
            document.body.appendChild(textArea);

            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopyFeedback(elementId);
                } else {
                    alert('Copy failed. Please select the text and copy manually.');
                }
            } catch (err) {
                console.error('Fallback copy failed:', err);
                alert('Copy failed. Please select the text and copy manually.');
            }

            document.body.removeChild(textArea);
        }

        function showCopyFeedback(elementId) {
            // Find button next to the text
            const container = document.getElementById(elementId).parentElement;
            const btn = container.querySelector('.copy-btn');
            const original = btn.textContent;
            btn.textContent = 'Copied!';
            btn.style.backgroundColor = '#27C93F';
            setTimeout(() => {
                btn.textContent = original;
                btn.style.backgroundColor = '';
            }, 2000);
        }

        // Init
        // Initialize default data
        for (let i = 1; i <= 6; i++) {
            agentData[i] = getAgentData(i);
        }
        update(6);

        input.addEventListener('input', (e) => {
            let val = parseInt(e.target.value);
            if (val < 1) val = 1;
            if (val > 30) val = 30;

            // Ensure data exists
            for (let i = 1; i <= val; i++) {
                if (!agentData[i]) agentData[i] = getAgentData(i);
            }

            update(val);
        });
    </script>

</body>

</html>